<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>College Eight Lookup</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>

    <style>

        body {
            padding: 40px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
        }

        th {
            height: 50px;
            text-align: left;
        }

        th, td {
            padding: 10px;
        }

        table, th, td {
            border: 1px solid;
        }
        select {
            40px;
        }

        tr:nth-child(even) {background-color: #f2f2f2}

    </style>

</head>
<body>
    <div>
        <a href="/">
            <img width='auto' height='auto' id='logo' src='http://www.ucsc.edu/identity/images/ucsc-stack.jpg'/>
        </a> <br>
        Use the select box to find your WCMS site. If you don't see your site in the select box, the phrase "College Eight" does not appear on your site. <br>
        <form action="/" method="get" name="get_url">
            {{ form.subdomain(id="editable-select", placeholder="Enter your subdomain") }}
            <input type="submit" value="Search">
        </form>
        <br>
        {% if results %}
            <a href="#" class="export">Download CSV</a>
            <div id="dvData">
                <table>
                    <tr>
                        <th>Site</th>
                        <th>File Path</th>
                    </tr>
                    {% for subdomain, url in results %}
                    <tr>
                        <td>{{ subdomain }}</td>
                        <td><a href="http://{{ subdomain }}.ucsc.edu/{{ url }}">{{ url }}</a></td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
        {% endif %}
        {% if error %}
            <h1>No Results Found</h1>
        {% endif %}
    </div>

    <script>

        $('select').select2();

        $(document).ready(function () {

            function exportTableToCSV($table, filename) {

                var $rows = $table.find('tr:has(td)'),

                    // Temporary delimiter characters unlikely to be typed by keyboard
                    // This is to avoid accidentally splitting the actual contents
                    tmpColDelim = String.fromCharCode(11), // vertical tab character
                    tmpRowDelim = String.fromCharCode(0), // null character

                    // actual delimiter characters for CSV format
                    colDelim = '","',
                    rowDelim = '"\r\n"',

                    // Grab text from table into CSV formatted string
                    csv = '"' + $rows.map(function (i, row) {
                        var $row = $(row),
                            $cols = $row.find('td');

                        return $cols.map(function (j, col) {
                            var $col = $(col),
                                text = $col.text();

                            return text.replace(/"/g, '""'); // escape double quotes

                        }).get().join(tmpColDelim);

                    }).get().join(tmpRowDelim)
                        .split(tmpRowDelim).join(rowDelim)
                        .split(tmpColDelim).join(colDelim) + '"',

                    // Data URI
                    csvData = 'data:application/csv;charset=utf-8,' + encodeURIComponent(csv);

                $(this)
                    .attr({
                    'download': filename,
                        'href': csvData,
                        'target': '_blank'
                });
            }

            // This must be a hyperlink
            $(".export").on('click', function (event) {
                // CSV
                exportTableToCSV.apply(this, [$('#dvData>table'), 'export.csv']);

                // IF CSV, don't do event.preventDefault() or return false
                // We actually need this to be a typical hyperlink
            });
        });
    </script>
</body>
</html>